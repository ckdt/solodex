<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Solodex</title>
  <meta name="description" content="Solodex â€” start building here" />

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Instrument+Serif&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header>
    <h1>
      <img src="assets/img/logo-full.svg" alt="Solodex" title="solodex" class="img"/></h1>
    <h2>Ditch the updates, save your contacts.</h2>
  </header>

  <main>
   

    <div class="base">
      <div class="base__top">
      <div class="side side--left">
        <div class="knob knob--left">
          <div class="knob__dial">
            <div class="knob__dial__glimpse"></div>
          </div>
          <div class="knob__shaft"></div>
        </div>
        <div class="arm arm--left">
          <div class="arm__bottom"></div>
        </div>
      </div>
      <div class="middle">
        <div class="middle__top">

          <div class="card__ring">
            <div class="card__ring__inner"></div>
            <div class="card__ring__inner"></div>
          </div>

          <div class="cards__list">
            <!-- Cards will be dynamically generated here -->
          </div>
        </div>
        <div class="middle__bottom">
          <div class="middle__bottom__branding">
            <img src="assets/img/logo.svg" alt="Solodex Logo" />
          </div>
        </div>

      </div>

      <div class="side side--right">
        <div class="arm arm--right">
          <div class="arm__bottom"></div>
        </div>
        <div class="knob knob--right">
          <div class="knob__dial">
            <div class="knob__dial__glimpse"></div>
          </div>
          <div class="knob__shaft"></div>
        </div>
      </div>
     
      </div>
      <div class="base__bottom">
         <img src="assets/img/base-footer.svg" alt="Solodex footer" />
      </div>
    </div>

  <footer>
    <small>&copy; <span id="year"></span></small>
  </footer>

  <script>
    // Contact data
    const contactsData = [
      {
        name: 'Ronny Wieckardt',
        title: 'Digital Designer',
        email: 'ronny@allthis.digital',
        website: 'allthis.digital',
        websiteUrl: 'https://allthis.digital',
        notes: 'Creative director & interaction designer'
      },
      {
        name: 'Jane Smith',
        title: 'Product Manager',
        email: 'jane@example.com',
        website: 'example.com',
        websiteUrl: 'https://example.com',
        notes: 'Leading product innovation'
      },
      {
        name: 'John Developer',
        title: 'Full Stack Engineer',
        email: 'john@example.com',
        website: 'johndeveloper.dev',
        websiteUrl: 'https://johndeveloper.dev',
        notes: 'Building scalable solutions'
      }
    ];

    // Generate cards from JSON data
    function renderCards(contacts) {
      const cardsList = document.querySelector('.cards__list');
      cardsList.innerHTML = '';
      
      contacts.forEach((contact, index) => {
        const card = document.createElement('div');
        card.className = 'card vertical';
        card.ontouchstart = function() { this.classList.toggle('hover'); };
        
        card.innerHTML = `
          <div class="card__container">
            <div class="card__front">
              <p><strong>${contact.name}</strong></p>
              <p>${contact.title}</p>
              <p>
                <a href="mailto:${contact.email}">${contact.email}</a><br />
                <a href="${contact.websiteUrl}">${contact.website}</a>
              </p>
            </div>
            <div class="card__back">
              <p><strong>${contact.name}</strong></p>
              <p>${contact.notes}</p>
            </div>
          </div>
        `;
        
        // position stacked cards with slight vertical offset and set z-index
        card.style.top = `${index * 8}px`;
        card.style.zIndex = `${contacts.length - index}`;

        // store index for reference
        card.dataset.index = index;

        cardsList.appendChild(card);
      });
      
      // Re-attach scroll event listener to new cards and ensure initial state
      attachScrollListener();
    }

    // Attach scroll event listener and implement rolodex rotation
    function attachScrollListener() {
      const cardsList = document.querySelector('.cards__list');
      let isAnimating = false;

      // remove any previous handler then attach
      document.removeEventListener('wheel', wheelHandler);
      document.addEventListener('wheel', wheelHandler, { passive: false });

      function wheelHandler(e) {
        e.preventDefault();
        if (isAnimating) return;

        const delta = e.deltaY;
        if (delta > 0) {
          // scroll down -> flip top card away and move it to bottom
          const topCard = cardsList.querySelector('.card');
          if (!topCard) return;
          isAnimating = true;
          topCard.classList.add('scroll-down');

          const container = topCard.querySelector('.card__container');
          const onEnd = (ev) => {
            if (ev.target !== container) return;
            container.removeEventListener('transitionend', onEnd);
            // reset state and move card to bottom
            topCard.classList.remove('scroll-down');
            cardsList.appendChild(topCard);
            // reflow positions
            updateStackPositions();
            isAnimating = false;
          };

          container.addEventListener('transitionend', onEnd);
        } else if (delta < 0) {
          // scroll up -> bring last card to top and flip it into view
          const lastCard = cardsList.lastElementChild;
          if (!lastCard) return;
          isAnimating = true;

          // prepare card as pre-flipped (instant, no transition)
          lastCard.classList.add('pre-flip');
          // move to top
          cardsList.prepend(lastCard);
          updateStackPositions();

          // force reflow so the no-transition state applies
          // then remove pre-flip to animate to front
          requestAnimationFrame(() => {
            // allow transition to run by forcing reflow then removing class
            requestAnimationFrame(() => {
              lastCard.classList.remove('pre-flip');
              const container = lastCard.querySelector('.card__container');
              const onEnd = (ev) => {
                if (ev.target !== container) return;
                container.removeEventListener('transitionend', onEnd);
                isAnimating = false;
              };
              container.addEventListener('transitionend', onEnd);
            });
          });
        }
      }

      function updateStackPositions() {
        const cards = Array.from(cardsList.querySelectorAll('.card'));
        cards.forEach((card, idx) => {
          card.style.top = `${idx * 8}px`;
          card.style.zIndex = `${cards.length - idx}`;
        });
      }

      // expose update for initial layout
      updateStackPositions();
    }

    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
      document.getElementById('year').textContent = new Date().getFullYear();
      renderCards(contactsData);
    });
  </script>
</body>
</html>